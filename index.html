<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>IELTS Speaking - Part 2</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>
    :root{
      --bg:#f7f8fc; --text:#222; --muted:#666; --card:#ffffff; --border:#e5e7ef;
      --btn-record:#e55353; --btn-pause:#ffb020; --btn-stop:#6b7280;
      --btn-play:#22c55e; --btn-upload:#3b82f6; --btn-copy:#64748b;
      --btn-hover-filter: brightness(0.95);
      --accent:#3b82f6; --chip:#eef2ff;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--text);
    }
    .wrap{ max-width: 860px; margin: 24px auto 36px; padding: 0 16px; }

    /* Centered site header with logo + Chinese title */
    .site-header{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:10px; margin-top:18px; text-align:center;
    }
    .site-header img{ height:64px; width:64px; object-fit:contain; }
    .site-header .moe{ font-weight: 900; font-size: 30px; } /* increased size */

    /* Centered (smaller) page title */
    .page-title{
      text-align:center; margin: 8px auto 18px; font-size: 20px; font-weight: 800; /* reduced size */
    }

    header, .panel{
      background: var(--card); border:1px solid var(--border); border-radius:14px; padding:16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.04);
    }

    label{ display:block; font-weight:600; margin-bottom:.4rem; }
    input[type="text"]{
      width:100%; padding:.6rem .75rem; border:1px solid var(--border); border-radius:8px; background:#fff;
      font-size:1rem;
    }

    /* Prompt Section */
    .prompt-card{ margin-top:12px; }
    .prompt-row{
      display:grid; grid-template-columns: 1fr auto; gap:.5rem; align-items:start;
    }
    .prompt-box{
      white-space: pre-wrap;
      border:1px solid var(--border);
      border-radius:8px;
      background:#fff;
      padding:.75rem .9rem;
      min-height: 7rem; /* static box, no scrollbar */
      overflow: hidden;   /* ensure no scroll bar */
      font-size: 1rem;
    }
    .btn{
      appearance:none; border:0; padding:.6rem .9rem; border-radius:10px;
      color:#fff; font-weight:700; cursor:pointer; transition: filter .15s, transform .02s;
      box-shadow: 0 4px 14px rgba(0,0,0,.06);
    }
    .btn:hover:not(:disabled){ filter: var(--btn-hover-filter); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }
    .btn-ghost{
      background:#eef2ff; color:#1f2a44; border:1px solid var(--border);
    }

    details{
      margin-top:.6rem; border:1px solid var(--border); border-radius:10px; background:#fff;
    }
    details > summary{
      padding:.6rem .8rem; list-style:none; cursor:pointer; user-select:none; font-weight:600;
    }
    details > summary::-webkit-details-marker{ display:none; }
    details[open] > summary{ border-bottom:1px solid var(--border); }
    .details-body{ padding:.75rem .9rem; color:#333; }
    .chips{ display:flex; flex-wrap:wrap; gap:.4rem; }
    .chip{
      background: var(--chip); border:1px solid #dbe4ff; color:#1e293b;
      padding:.25rem .5rem; border-radius:999px; font-size:.9rem;
    }

    .controls{
      display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center; margin: 16px 0 6px;
    }
    .btn-record{ background: var(--btn-record); }
    .btn-pause { background: var(--btn-pause); color:#111; }
    .btn-stop  { background: var(--btn-stop); }
    .btn-play  { background: var(--btn-play); color:#0b3015; }
    .btn-upload{ background: var(--btn-upload); }
    .btn-copy  { background: var(--btn-copy); }

    .status{ text-align:center; margin:10px 0 4px; font-weight:600; color:var(--muted); }
    .status.ok{ color:#16a34a; } .status.err{ color:#e11d48; } .status.warn{ color:#b45309; }

    .meter{ background: var(--card); border:1px solid var(--border); border-radius:14px; padding:12px; margin-top:10px; }
    canvas#wave{ width:100%; height:110px; display:block; background:#fff; border:1px solid var(--border); border-radius:10px; }

    audio{ width:100%; margin-top:.6rem; }

    .share{
      display:flex; gap:.5rem; margin-top:10px;
    }
    .share input{
      flex:1; padding:.6rem .75rem; border:1px solid var(--border); border-radius:8px; background:#fff;
      font-size:1rem;
    }
  
/* === Applied patch: prompt + sample styling === */
.prompt-box {
  background: #ecf0f1;
  color: #2c3e50;
}

/* Sample answer text styling */
#sampleText {
  color: #34495e;
  font-style: italic;
}
</style>
</head>
<body>
<!-- Centered site header -->
<div class="site-header" style="display:flex; flex-direction:row !important; align-items:center; justify-content:center; gap:12px; margin-bottom:20px;">
<img alt="Logo" src="LOGO.png" style="height:60px; width:60px; object-fit:contain;"/>
<span class="moe" style="font-size:28px; font-weight:bold;">教育部 - 出国人员培训部</span>
</div>
<!-- Centered page title -->
<h1 class="page-title">IELTS Speaking - Part 2</h1>
<div class="wrap">
<header>
<label for="nameInput">Your name (English name or pinyin)</label>
<input id="nameInput" placeholder="e.g., Li Hua / Zhang Wei" type="text"/>
<!-- Interactive Prompt Section -->
<div class="prompt-card">
<label for="promptBox">Topic card:</label>
<div class="prompt-row">
<div aria-live="polite" class="prompt-box" id="promptBox"></div>
<button class="btn btn-ghost" id="shuffleBtn" title="Get another prompt">Shuffle</button>
</div>
<details id="sampleDetails">
<summary>Sample answer</summary>
<div class="details-body">
<div id="sampleText">Select a prompt to see a sample answer.</div>
</div>
</details>
<details id="vocabDetails">
<summary>Useful vocabulary</summary>
<div class="details-body">
<div class="chips" id="vocabChips"></div>
</div>
</details>
</div>
</header>
<!-- Recording + Upload -->
<section class="panel" style="margin-top:14px">
<div class="controls">
<button class="btn btn-record" id="recordBtn">● Record</button>
<button class="btn btn-pause" disabled="" id="pauseBtn">Pause</button>
<button class="btn btn-stop" disabled="" id="stopBtn">■ Stop</button>
<button class="btn btn-play" disabled="" id="playBtn">▶ Play</button>
<button class="btn btn-upload" disabled="" id="uploadBtn">⤴ Upload</button>
</div>
<div class="status" id="status">Idle</div>
<div class="meter">
<canvas aria-label="Microphone waveform" height="180" id="wave" width="800"></canvas>
</div>
<audio controls="" id="audioPlayback"></audio>
<div class="share" id="linkBox" style="display:none;">
<input id="shareUrl" readonly="" type="text"/>
<button class="btn btn-copy" id="copyBtn">Copy</button>
</div>
</section>
</div>
<script>
/* ======= SET YOUR UPLOADCARE PUBLIC KEY ======= */
const UPLOADCARE_PUBLIC_KEY = "bfa231bda557ed1948e3"; // <-- replace with your Uploadcare public key
/* ============================================== */

/* ======= YOUR 8 PROMPTS, SAMPLES, VOCAB ======= */
const PROMPTS = [
  {
    text:
`Describe a school subject you enjoyed learning.<br>
You should say:
• What the subject was
• How it was taught
• What you learned from it
• And explain why you enjoyed it`,
    sample:
`One school subject I really enjoyed was history. I studied it throughout high school, and it was taught by a teacher who had a real passion for the subject. He didn’t just rely on textbooks; instead, he often used stories, documentaries, and even role-play activities to bring historical events to life. I remember learning about the French Revolution in a way that felt more like watching a movie than sitting in class.

From this subject, I learned not only about important events and figures, but also about how history shapes modern society. I particularly enjoyed analyzing causes and consequences, which made me feel like a detective solving puzzles.

I think I enjoyed history because it was never just about memorizing dates. It encouraged critical thinking, discussion, and connecting the past with the present. This subject really expanded my perspective on the world and influenced the way I understand current events.`,
    vocab: [
      "Memorize formulas – 记忆公式",
      "Critical thinking – 批判性思维",
      "Abstract concepts – 抽象概念",
      "Real-life applications – 实际应用",
      "Problem-solving skills – 解决问题的能力",
      "Analytical approach – 分析方法",
      "Expand my perspective – 开阔我的视野",
      "Struggle with a subject – 在某个科目上有困难",
      "Broaden my knowledge – 拓宽我的知识",
      "Apply in daily life – 应用于日常生活"
    ]
  },
  {
    text:
`Describe a school subject you found difficult.<br>
You should say:
• What the subject was
• Why you found it difficult
• How you tried to improve
• And explain whether you think it’s still useful for you now`,
    sample:
`The subject I always struggled with at school was chemistry. It involved a lot of abstract concepts, such as molecular structures and chemical equations, which I found quite hard to grasp. Unlike subjects like literature, where I could rely on creativity and interpretation, chemistry required precision and logical thinking, and I often felt lost in class.

To improve, I attended extra tutorials and tried to memorize formulas by practicing exercises repeatedly. I also watched online experiments to visualize reactions, which helped me a little. Despite my efforts, I never became very good at it.

However, I still think chemistry is useful because it explains so many things in everyday life, such as how food is preserved or how medicines are created. Even though I didn’t master it, the subject taught me patience and problem-solving skills, which I value now as an adult.`,
    vocab: [
      "Memorize formulas – 记忆公式",
      "Critical thinking – 批判性思维",
      "Abstract concepts – 抽象概念",
      "Real-life applications – 实际应用",
      "Problem-solving skills – 解决问题的能力",
      "Analytical approach – 分析方法",
      "Expand my perspective – 开阔我的视野",
      "Struggle with a subject – 在某个科目上有困难",
      "Broaden my knowledge – 拓宽我的知识",
      "Apply in daily life – 应用于日常生活"
    ]
  },
  {
    text:
`Describe a job you would like to have in the future.<br>
You should say:
• what the job is
• what skills are required
• why you are interested in it
• and explain whether it is a popular job in your country.`,
    sample:
`One job I would like to have in the future is working as a university lecturer. I’ve always enjoyed teaching, and I find it rewarding to guide students in their learning journey.

To be successful in this role, strong communication skills and deep knowledge in a particular subject are required. In addition, patience and adaptability are important because every student learns at a different pace.

I am interested in this career because it combines my passion for education and research. Although the job is competitive, it is considered prestigious in my country, and many people see it as a stable and respectable career.`,
    vocab: [
      "Career prospects — 职业前景",
      "Job satisfaction — 工作满意度",
      "Work-life balance — 工作与生活的平衡",
      "Professional growth — 职业发展",
      "Stable income — 稳定收入",
      "Prestigious occupation — 体面的职业",
      "Competitive field — 竞争激烈的领域",
      "Passion for education — 对教育的热情",
      "Lifelong learning — 终身学习",
      "Job security — 工作保障"
    ]
  },
  {
    text:
`Describe a person whose personality you admire.<br>
You should say:
• who this person is
• what kind of personality he/she has
• how you got to know him/her
• and explain why you admire this person.`,
    sample:
`One person whose personality I really admire is my high school teacher. She is incredibly patient and supportive, always encouraging students to reach their full potential. She has a positive outlook on life and treats everyone with respect, regardless of their background.

I got to know her when she became my English teacher, and her kindness left a deep impression on me.

I admire her because she not only taught us academic knowledge but also valuable life lessons. Her sense of responsibility and empathy truly inspired me to become a better person.`,
    vocab: [
      "Positive outlook — 积极的态度",
      "Sense of responsibility — 责任感",
      "Strong-willed — 意志坚定的",
      "Empathetic — 有同理心的",
      "Open-minded — 思想开明的",
      "Down-to-earth — 脚踏实地的",
      "Charismatic personality — 有魅力的个性",
      "Role model — 榜样",
      "Treat others with respect — 尊重他人",
      "Inspire confidence — 激发信心"
    ]
  },
  {
    text:
`Describe a movie or TV program you recently enjoyed.<br>
You should say:
• what it was
• what it was about
• why you liked it
• and explain whether you would recommend it to others.`,
    sample:
`A TV series I recently enjoyed was The Crown. It’s a historical drama that portrays the life and reign of Queen Elizabeth II.

The series impressed me with its high production quality, detailed costumes, and strong performances by the actors. I particularly liked how it combined real historical events with personal struggles, making it both educational and entertaining.

I would definitely recommend it to others, especially those interested in history and politics, because it provides insight into the challenges faced by leaders.`,
    vocab: [
      "High production quality — 高质量制作",
      "Engaging storyline — 吸引人的情节",
      "Outstanding performance — 出色的表演",
      "Character development — 人物塑造",
      "Educational value — 教育价值",
      "Emotional impact — 情感冲击",
      "Genre of drama/comedy — 剧情/喜剧类型",
      "Captivating visuals — 迷人的画面",
      "Recommend to others — 推荐给别人",
      "Thought-provoking — 发人深省的"
    ]
  },
  {
    text:
`Describe a job you think would be very interesting.<br>
You should say:
• What the job is
• What skills are required
• Why you find it interesting
• And explain whether you would like to do it yourself`,
    sample:
`One job I’ve always found fascinating is being a travel documentary filmmaker. This role requires not only technical skills like handling a camera and editing footage but also creativity and adaptability, since you often work in unpredictable environments.

What makes it so interesting is that you get to explore different cultures, tell stories visually, and share unique perspectives with a global audience.

I would definitely like to try it because it combines two of my passions: traveling and storytelling. Even though it can be exhausting, I think the sense of adventure and the impact on viewers make it worthwhile.`,
    vocab: [
      "career path 职业道路",
      "job satisfaction 工作满意度",
      "transferable skills 可转移技能",
      "work-life balance 工作与生活的平衡",
      "demanding job 要求高的工作",
      "professional development 职业发展",
      "rewarding experience 有回报的经历",
      "long-term prospects 长期前景",
      "financial stability 财务稳定",
      "pursue a career 追求事业"
    ]
  },
  {
    text:
`Describe a person you know who has a strong personality.<br>
You should say:
• Who this person is
• What kind of personality they have
• How you know them
• And explain why you find their personality impressive`,
    sample:
`One of my close friends has a very strong personality. She’s confident, outspoken, and never afraid to stand up for what she believes in.

I first met her in university, and since then I’ve admired how she handles pressure and takes initiative in group projects. Her determination and leadership qualities often inspire others around her.

I find her personality impressive because she manages to be assertive without being arrogant. It’s the kind of strength I hope to develop more in myself.`,
    vocab: [
      "self-confident 自信的",
      "open-minded 思想开明的",
      "introverted 内向的",
      "extroverted 外向的",
      "strong-willed 意志坚定的",
      "easy-going 随和的",
      "sense of humor 幽默感",
      "leadership skills 领导能力",
      "empathetic 有同理心的",
      "assertive 坚定自信的"
    ]
  },
  {
    text:
`Describe a film or TV show that left a strong impression on you.<br>
You should say:
• What it was
• What it was about
• Why you watched it
• And explain why it impressed you`,
    sample:
`A TV show that really impressed me is Chernobyl, a historical drama based on the nuclear disaster in 1986. I watched it because I’m interested in real-life events and how they are portrayed on screen.

The series was extremely well-produced, with excellent acting and a haunting atmosphere that kept me engaged. What impressed me most was the way it showed human courage and sacrifice in the face of tragedy, as well as the dangers of misinformation.

It was both emotionally moving and thought-provoking, which is why it stands out in my memory.`,
    vocab: [
      "binge-watch 追剧",
      "gripping storyline 扣人心弦的情节",
      "emotional impact 情感冲击",
      "critically acclaimed 广受好评的",
      "cultural significance 文化意义",
      "thought-provoking 发人深省的",
      "outstanding performance 杰出的表演",
      "visual effects 视觉效果",
      "soundtrack 原声音乐",
      "box office success 票房成功"
    ]
  }
];
/* ======================================== */

const nameInput = document.getElementById('nameInput');
const promptBox = document.getElementById('promptBox');
const shuffleBtn  = document.getElementById('shuffleBtn');
const sampleDetails = document.getElementById('sampleDetails');
const sampleText  = document.getElementById('sampleText');
const vocabDetails= document.getElementById('vocabDetails');
const vocabChips  = document.getElementById('vocabChips');

const recordBtn = document.getElementById('recordBtn');
const pauseBtn  = document.getElementById('pauseBtn');
const stopBtn   = document.getElementById('stopBtn');
const playBtn   = document.getElementById('playBtn');
const uploadBtn = document.getElementById('uploadBtn');
const statusEl  = document.getElementById('status');
const audioEl   = document.getElementById('audioPlayback');
const linkBox   = document.getElementById('linkBox');
const shareUrl  = document.getElementById('shareUrl');
const copyBtn   = document.getElementById('copyBtn');

const wave      = document.getElementById('wave');
const wctx      = wave.getContext('2d');

let mediaRecorder;
let audioChunks = [];
let audioBlob;

// waveform state
let audioCtx = null, analyser = null, dataArray = null, rafId = null, stream = null;

// ---------- Prompt logic ----------
let currentIndex = -1;

function renderPrompt(idx){
  const p = PROMPTS[idx];
  promptBox.innerHTML = p.text;
  sampleText.textContent = p.sample;
  vocabChips.innerHTML = p.vocab.map(w => `<span class="chip">${w}</span>`).join("");
  sampleDetails.open = false;
  vocabDetails.open = false;
}

function randomIndex(exclude){
  if (PROMPTS.length === 1) return 0;
  let i = Math.floor(Math.random() * PROMPTS.length);
  while (i === exclude) i = Math.floor(Math.random() * PROMPTS.length);
  return i;
}

function shufflePrompt(){
  if (!PROMPTS.length) return;
  currentIndex = randomIndex(currentIndex);
  renderPrompt(currentIndex);
}

if (PROMPTS.length){
  currentIndex = Math.floor(Math.random() * PROMPTS.length);
  renderPrompt(currentIndex);
}
shuffleBtn.addEventListener('click', shufflePrompt);

// ---------- Recorder logic ----------
function setStatus(msg, cls=''){ statusEl.className='status '+cls; statusEl.textContent = msg; }

function slugifyName(raw) {
  if (!raw) return "";
  return raw.trim().toLowerCase().replace(/[\\s]+/g,"_").replace(/[^a-z0-9_-]/g,"");
}
function buildFilename(mimeType) {
  const nameSlug = slugifyName(nameInput.value) || "recording";
  const now = new Date();
  const pad = n => String(n).padStart(2,'0');
  const ext = (mimeType && mimeType.includes('ogg')) ? 'ogg' : 'webm';
  return `${nameSlug}_${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}_${pad(now.getHours())}-${pad(now.getMinutes())}-${pad(now.getSeconds())}.${ext}`;
}

function clearCanvas(){
  const dpr = window.devicePixelRatio || 1;
  const cssW = wave.clientWidth, cssH = 110;
  if (wave.width !== Math.floor(cssW * dpr)) {
    wave.width = Math.floor(cssW * dpr);
    wave.height = Math.floor(cssH * dpr);
  }
  wctx.setTransform(1,0,0,1,0,0);
  wctx.scale(dpr, dpr);
  wctx.clearRect(0,0, cssW, cssH);
  wctx.fillStyle = '#ffffff';
  wctx.fillRect(0,0, cssW, cssH);
}
function drawWave(){
  clearCanvas();
  if (!analyser) return;

  analyser.getByteTimeDomainData(dataArray);
  const cssW = wave.clientWidth, cssH = wave.height / (window.devicePixelRatio||1);

  // midline
  wctx.strokeStyle = 'rgba(0,0,0,0.08)';
  wctx.lineWidth = 1;
  wctx.beginPath();
  wctx.moveTo(0, cssH/2);
  wctx.lineTo(cssW, cssH/2);
  wctx.stroke();

  // waveform
  wctx.strokeStyle = '#3b82f6';
  wctx.lineWidth = 2;
  wctx.beginPath();
  const slice = cssW / dataArray.length;
  let x = 0;
  for (let i = 0; i < dataArray.length; i++) {
    const v = dataArray[i] / 128.0;
    const y = v * cssH/2;
    if (i === 0) wctx.moveTo(x, y);
    else wctx.lineTo(x, y);
    x += slice;
  }
  wctx.stroke();

  rafId = requestAnimationFrame(drawWave);
}
function stopWave(){
  if (rafId) cancelAnimationFrame(rafId);
  rafId = null;
  if (audioCtx) { try{ audioCtx.close(); }catch(_){} audioCtx = null; }
  analyser = null; dataArray = null;
}

recordBtn.onclick = async () => {
  try {
    stream = await navigator.mediaDevices.getUserMedia({ audio: true });

    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 2048;
    dataArray = new Uint8Array(analyser.fftSize);
    audioCtx.createMediaStreamSource(stream).connect(analyser);
    drawWave();

    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    mediaRecorder.ondataavailable = e => { if (e.data && e.data.size > 0) audioChunks.push(e.data); };
    mediaRecorder.onstop = () => {
      audioBlob = new Blob(audioChunks, { type: mediaRecorder.mimeType || 'audio/webm' });
      const url = URL.createObjectURL(audioBlob);
      audioEl.src = url;
      playBtn.disabled = false;
      uploadBtn.disabled = false;
      setStatus('Recording finished. You can preview or upload the audio.','ok');
      try{ stream.getTracks().forEach(t=>t.stop()); }catch(_){}
      stopWave();
      stream = null;
    };

    mediaRecorder.start();
    setStatus('Recording…');
    recordBtn.disabled = true;
    pauseBtn.disabled  = true;
    stopBtn.disabled   = false;
    mediaRecorder.onstart = () => { pauseBtn.disabled = false; };

  } catch (err) {
    console.error(err);
    alert("Microphone access denied or error starting recording.");
    setStatus('Microphone error.','err');
  }
};

pauseBtn.onclick = () => {
  if (!mediaRecorder) return;
  if (mediaRecorder.state === "recording") {
    mediaRecorder.pause();
    setStatus('Paused','warn');
    pauseBtn.textContent = 'Resume';
  } else if (mediaRecorder.state === "paused") {
    mediaRecorder.resume();
    setStatus('Recording…');
    pauseBtn.textContent = 'Pause';
  }
};

stopBtn.onclick = () => {
  if (mediaRecorder && (mediaRecorder.state === "recording" || mediaRecorder.state === "paused")) {
    mediaRecorder.stop();
    recordBtn.disabled = false;
    pauseBtn.disabled = true;
    pauseBtn.textContent = 'Pause';
    stopBtn.disabled = true;
  }
};

playBtn.onclick = () => { if (audioBlob) audioEl.play(); };

uploadBtn.onclick = async () => {
  if (!audioBlob) return;
  if (!UPLOADCARE_PUBLIC_KEY || UPLOADCARE_PUBLIC_KEY === "demopublickey") {
    alert("Please set your Uploadcare public key in the code.");
    return;
  }
  setStatus('Uploading…');

  try {
    const fname = buildFilename(audioBlob.type);
    const form = new FormData();
    form.append('UPLOADCARE_PUB_KEY', UPLOADCARE_PUBLIC_KEY);
    form.append('UPLOADCARE_STORE', '1');
    form.append('file', new File([audioBlob], fname, { type: audioBlob.type || 'application/octet-stream' }));

    const res = await fetch('https://upload.uploadcare.com/base/', { method: 'POST', body: form });
    const json = await res.json();
    if (!json.file) throw new Error("Uploadcare response invalid.");

    const publicUrl = `https://ucarecdn.com/${json.file}/${encodeURIComponent(fname)}`;
    shareUrl.value = publicUrl;
    linkBox.style.display = "flex";
    copyBtn.disabled = false;
    setStatus('Uploaded!','ok');
  } catch (err) {
    console.error(err);
    alert("Upload failed. Check your network or try again.");
    setStatus('Upload failed.','err');
  }
};

copyBtn.onclick = () => {
  shareUrl.select();
  document.execCommand('copy');
  setStatus('Link copied!','ok');
};

// responsive canvas
window.addEventListener('resize', () => { if (analyser) clearCanvas(); });
</script>
</body>
</html>
